\chapter{Prototipos}

Durante el desarrollo del proyecto se han realizado varios prototipos para probar las diferentes funcionalidades del sistema. En este capítulo se describen los prototipos realizados y las pruebas realizadas. Se ha usado la placa de desarrollo ESP32S3-DevKitC-1 para realizar los prototipos en una protoboard junto con un multiplexor DIP en vez de SMD para facilitar la conexión de los cables. Durante el desarrollo de los prototipos se ha empleado solo un pequeño porcentaje de las teclas del producto final. Solo se han usado las teclas para controlar la pantalla y 3 teclas extra de funcionalidad, una letra, el shift y el espacio.


\section{Versiones}
Durante el desarrollo del proyecto se han realizado varias versiones de los prototipos. En este apartado se describen las diferentes versiones de los prototipos realizados.

\subsection{V1: Correcciones}
La primera de todas las versiones no contemplaba protocolo \glsnocase{Bluetooth} y tampoco poseía la pantalla \gls{OLED}. Se realizó para probar el funcionamiento de los interruptores y la \gls{PCB}. Se usó un microcontrolador Atmega32U4 y un multiplexor DIP para facilitar la soldadura.

Principalmente, este prototipo fue para probar las dimensiones de la \gls{PCB} y la disposición de los interruptores. Además de la ergonomía del teclado. Esta primera versión se llama Tesseract \cite{Tesseract}.

\subsection{V2: Correcciones}
Esta versión fue una modificación del teclado Tesseract \cite{Tesseract} para cambiar la ergonomía, ya que era muy tosco y no era cómodo de usar. Se cambió la disposición del puerto \gls{USB}, ya que la primera versión usaba un \gls{USB} B y la nueva versión usa un \gls{USB} A.

\subsection{V3: Modificaciones}
Tras las ultimas dos versiones se decidió ampliar la funcionalidad creando el nuevo modelo ModernWood. Este incluiría una pantalla \gls{OLED} y un protocolo \gls{Bluetooth} para poder usar el teclado con dispositivos móviles. Se cambió el microcontrolador a un ESP32S3. Se cambió el material de la carcasa a madera y se añadió un difusor para los \gls{LED}s. Se añadió una batería de litio para poder usar el teclado sin cables y se cambió el conector \gls{USB} a un conector XS-12 para que fuera todavía más robusto.

\section{Problemas y Errores} \label{Errores}
En este apartado se describen los problemas y errores encontrados durante el desarrollo de los prototipos. Estos no han sido corregidos en las versiones de los prototipos, pero se han tenido en cuenta para el diseño del producto final.
\subsection{Corriente inversa en el regulador de tensión} \label{CorrienteInversa}
\subsection{Voltaje en la salida del regulador de tensión} \label{VoltajeRegulador}

\newpage
\section{Montaje}
Esta sección describe el montaje del teclado en completo detalle. Se usará como explicación para el producto final y para saber el orden y la manera de proceder para el montaje del teclado. Ya que está diseñado para ser ensamblado en unos pasos concretos.

\subsubsection{Soldadura de los componentes de la PCB}
El primer paso es soldar los componentes de la PCB. Se debe soldar los componentes de menor tamaño primero y los de mayor tamaño después. Se debe tener cuidado con la polaridad de los componentes y con la temperatura de la soldadura para no dañar los componentes, esta debe de ser 250 °C para la pasta de soldadura y 300 °C para el soldador manual. Se debe soldar los componentes en el siguiente orden:

\begin{enumerate}
    \item Resistencias
    \item Condensadores
    \item Diodos
    \item Chip Batería
    \item Microcontrolador
    \item Pantalla
    \item Interruptores
    \item Cables para \gls{USB}
\end{enumerate}

Para soldar los componentes SMD se ha usado una pasta de soldadura de baja temperatura y una pistola de calor para fundir la pasta. Se ha usado un soldador manual para los componentes de mayor tamaño.

La pasta de soldadura se aplica junto con flux en las pistas de la \gls{PCB} y se coloca el componente encima. Se calienta la pasta con la pistola de calor hasta que se funda y se adhiera el componente a la \gls{PCB}. El propio estaño debe deslizarse hasta su posición en la pista y no debe ser empujado con la pistola de calor. Después de unos segundos de calentar, el chip debería haberse asentado en su posición. Se debe tener cuidado con la temperatura de la pistola de calor para no dañar los componentes.

Se ha de tener en cuenta la fuerza de la pistola de calor, ya que sí se pone la fuerza de la misma muy alta podría llegar a calentar otros componentes adyacentes y desoldarlos o dañarlos. \cite{SoldaduraSMD}

\subsubsection{atornillado de los estabilizadores}
Una vez soldados los componentes de la \gls{PCB} se ha de colocar los estabilizadores en la \gls{PCB}. Para ello se ha de colocar los estabilizadores en los agujeros de la \gls{PCB} y atornillarlos con los tornillos correspondientes. Se ha de tener cuidado con la fuerza ejercida para no romper la \gls{PCB} ni los estabilizadores.

\subsubsection{Programación del microcontrolador}
El siguiente paso es programar el microcontrolador. Para ello se debe conectar el microcontrolador a un programador, en nuestro caso el FT232RL y cargar el firmware en el microcontrolador. Se debe tener cuidado con la polaridad de los pines y con la conexión de los cables. Se debe conectar el programador al microcontrolador y al ordenador y cargar el firmware en el microcontrolador. Se debe comprobar que el firmware se ha cargado correctamente y que el microcontrolador funciona correctamente.

Para realizar esta tarea se emplearán los pines designados en la \gls{PCB} para la programación del microcontrolador.

\subsubsection{Difusor \glsnocase{LED}s}
Primero se ha de colocar el difusor sobre los \glsnocase{LED}s y se ha de atornillar con los tornillos pasantes sobre el difusor hasta una tuerca autoblocante que deberemos colocar en el otro extremo del tornillo. Se ha de tener cuidado con la fuerza ejercida para no romper el difusor ni la \gls{PCB}.

\subsubsection{Soldadura de cables para \gls{USB}}
Tanto en la placa base como en el conector XS-12 tenemos que soldar un cable de conexion Gx16-4 a la parte interna del conector y la parte hembra del conector a los pines correspondientes D+,D-,GND y VCC. Para ello se ha de soldar el cable a la parte interna del conector y a los pines de la placa base. Se ha de tener cuidado con la polaridad de los cables.

\subsubsection{Conector XS-12}
Una vez que tenemos la carcasa barnizada y con las tuercas empotradas deberemos colocar el conector XS-12 en su lugar correspondiente. Para ello se ha de colocar el conector en la carcasa y atornillarlo con los tornillos M3 de cabeza plana.

Después de atornillar el conector XS-12 y tener soldado los dos conectores Gx16 tendremos que conectarlos para dejarlos por debajo de la carcasa.

\subsubsection{Tornillos}
Una vez colocado el difusor y el conector XS-12 se puede colocar la \gls{PCB} en la carcasa, para ello a lo largo de toda la carcasa se encuentran unos agujeros para atornillar la placa.

En la carcasa se deben colocar los espaciadores de 3 mm en los agujeros y atornillarlos con un destornillador. Se debe tener cuidado con la fuerza ejercida para no mover o arrancar las tuercas empotradas.

Una vez colocados se pondrá la \gls{PCB} sobre los espaciadores dejando la batería en la parte inferior. Se atornillará la \gls{PCB} a los espaciadores con los tornillos M3 de cabeza redondeada.

Una vez montada la \gls{PCB} sobre la carcasa se colocará el protector de metacrilato sobre los circuitos de la \gls{PCB}. Para poder atornillar el protector de metacrilato a la carcasa se han de colocar unos espaciadores de 5 mm en los agujeros correspondientes a los del protector. Estos agujeros no han debido ser atornillados previamente. Ya que los espaciadores de 5 mm servirán para poder fijar la \gls{PCB} a la carcasa y para poder servir de tuerca al protector de metacrilato.

Una vez colocados los espaciadores de 5 mm se colocará el protector de metacrilato sobre la \gls{PCB} y se atornillará con los tornillos M3 de cabeza redondeada a los espaciadores de 5 mm.

\subsubsection{\gls{Keycaps}}
Para colocar los \gls{Keycaps} en los interruptores se ha de colocar la tecla sobre el interruptor y presionar hasta que se mantenga sobre el interruptor. Se ha de tener cuidado con la fuerza ejercida para no romper el interruptor ni la \gls{PCB}.